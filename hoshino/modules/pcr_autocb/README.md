# autocb

自动推送公会战进度，包括当期排名，周目，boss，血量。可以满足<sub>会长抓甜心刀以外的</sub>基本会战需求。因为之前的停止维护了所以自己写了个给自己用。

**注意事项：**  

**本插件使用 bigfun api，boss 进度及血量等信息最高可能存在 5 分钟的延迟。自动推送 boss 变更最高可能出现 7 分钟的延迟。**   

所有出刀记录会在次日凌晨 5:00 前写入数据库。<sub>报刀？报什么刀？躺平公会为什么要报刀？</sub>


## What's new
 - 21/12/26 增加了自动获取 BOSS 名字的功能。以后发送 `init@bot` 指令时会自动更新 `config.json` 中的 BOSS 列表。也可以通过发送指令`更新boss列表`手动更新。 


## 安装
下载或 `git clone` 本项目并放入 `modules` 文件夹下，在 `config/__bot.py__` 中添加本插件。**将本项目下的 `report.py` 复制到 `clanbattle_report` 下并替换掉原本的 `report.py` ，如果没有安装 [clanbattle_report](https://github.com/zyujs/clanbattle_report) 插件就直接删掉，不然可能会报错。**

## 使用

### 首次使用
1. 请自行登录 `https://www.bigfun.cn/tools/pcrteam/` 并将该网站 Cookie 中的 `session-api` 填入 `config.json`
2. 请在 `config.json` 中填入群号

### 公会战开始当日
1. 请用自己手机上的 bigfun 客户端登录并打开一次 pcr 团队战工具，确保手机app上能正确显示内容。
2. 请发送 `init` 初始化 bot

### 指令

| 指令 | 效果 |
| --- | --- |
| 作业 | 获取作业表链接 |
| 状态 | 获取公会当前排名、Boss 进度及血量 |
| sl | 记录一次 sl |
| sl? | 查询今日是否记录过 sl |
| 预约 1/2/3/4/5 | 预约 1/2/3/4/5 王 |
| 更新boss列表 | 更新当期的 BOSS 列表，在不能正确显示 BOSS 名称时使用 |
| gettime | 获取当期会战期间 |
| init@bot | （管理权限）初始化并重置预约表，更新BOSS列表 |
| 上树/挂树 | 挂树，55分钟后提醒下树 |
| 上树/挂树+数字 | 挂树，在X分钟后提醒下树 |
| 下树 | 下树并取消提醒 |
| 查树 | 看看树上都有谁 |
| 昨日日报 | 获取昨日 04:59 时的出刀数、排名及伤害 |
| 今日出刀 | 获取今日公会成员出刀数量 |
| 昨日出刀 | 获取昨日公会成员出刀数量 |
| 注册 + 游戏昵称 | 绑定自己的 QQ 账号与游戏角色 |
| 注册 + @成员 + 游戏昵称 | （SU权限）绑定指定 QQ 账号与游戏角色 |
| 查看注册信息 | 查看自己的绑定角色昵称 |
| 查看注册信息 + @成员 | （SU权限）查看指定 QQ 账号的绑定信息 |
| 更新注册 + 游戏昵称 | 更新绑定信息 
| 更新注册 + @成员 + 游戏昵称 | （SU权限）更新指定 QQ 账号的绑定信息 |
| 删除成员 + @成员/qq号 | （SU权限）删除绑定信息

### 生成会战报告（魔改版）
基于[这个项目](https://github.com/zyujs/clanbattle_report)的魔改版本。因为没有使用yobot而是用自带的数据库储存出刀信息，所以改了改获取数据的方法。自家用的时候似乎没什么问题，但无法保证稳定性。
